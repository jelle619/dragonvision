<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- makes the website responsive -->
  <title>Dragon Vision ‚Äî Visualisation 1</title>
  <link rel="stylesheet" type="text/css" href="css/global.css" media="screen" /> <!-- import global stylesheet -->
  <script src="https://d3js.org/d3.v6.min.js"></script> <!-- import D3.js, version 6 -->
</head>

<body>

  <div id='nav'>
    <a href="index.html">Homepage</a>
    <a href="visualisation1.html">Visualisation 1</a>
    <a href="visualisation2.html">Visualisation 2</a>
    <a href="credits.html">Credits</a>
  </div>

  <div id='main'>
    <h1>Visualisation 1</h1>
    <p>IT'S ALIIIVE! üî•üê≤<br>The visual below is made using D3.</p>

    <input type="file" id="input" accept=".csv, .txt"> <!-- HTML iput, user can select a file here. -->

    <script>
      document.getElementById('input').addEventListener('change', function selectedFileChanged() {
        if (this.files.length === 0) { // This statement will be true when the user cancels out of the upload dialog.
          console.log('No file selected.'); // Log to the console that the user has selected no file.
          return; // Exit the function, no need to do anything
        }

        const reader = new FileReader();
        reader.onload = function fileReadCompleted() {
          // when the reader is done, the content is in reader.result.
          console.log(reader.result);
          document.getElementById('result').innerHTML = reader.result;
        };
        // we will tell reader to interpret the file as text, so reader.result will be text also
        reader.readAsText(this.files[0]);
      });
    </script>

    <p style="display: block; background: white; color: black;" id="result"></p>

    <div id="visual"></div>

    <script>

      // create the svg area
      var svg = d3.select("#visual")
        .append("svg")
          .attr("width", 440)
          .attr("height", 440)
        .append("g")
          .attr("transform", "translate(220,220)")

      // create input data: a square matrix that provides flow between entities
      var matrix = [
        [11975,  5871, 8916, 2868],
        [ 1951, 10048, 2060, 6171],
        [ 8010, 16145, 8090, 8045],
        [ 1013,   990,  940, 6907]
      ];

      // give this matrix to d3.chord(): it will calculates all the info we need to draw arc and ribbon
      var res = d3.chord()
          .padAngle(0.05)     // padding between entities (black arc)
          .sortSubgroups(d3.descending)
          (matrix)

      // add the groups on the inner part of the circle
      svg
        .datum(res)
        .append("g")
        .selectAll("g")
        .data(function(d) { return d.groups; })
        .enter()
        .append("g")
        .append("path")
          .style("fill", "grey")
          .style("stroke", "black")
          .attr("d", d3.arc()
            .innerRadius(200)
            .outerRadius(210)
          )

      // Add the links between groups
      svg
        .datum(res)
        .append("g")
        .selectAll("path")
        .data(function(d) { return d; })
        .enter()
        .append("path")
          .attr("d", d3.ribbon()
            .radius(200)
          )
          .style("fill", "#69b3a2")
          .style("stroke", "black");

      </script>
  </div>

  <script type="text/javascript" src="script.js"></script> <!-- import JavaScript -->
</body>

</html>
